



m= fftn(imageObj.data(:,:,4,1,1,1,1));
figure
plot(real(m))


pe1 = [
  0,-1,-1,0,   0,-1,-2,-2,   -2,-2,-1,0,   1,1,1,1,     1,0,-1,-2, -3,-3,-3,-3,  -3,-3,-2,-1,   0,1,2,2, ... //0-31
   2,2,2,2,     2,1,0,-1,     -2,-3,-4,-4, -4,-4,-4,-4, -4,-4,-3,-2, -1,0,1,2,    3,3,3,3,       3,3,3,3, ... //32-63
   3,2,1,0,     -1,-2,-3,-4,  -5,-5,-5,-5, -5,-5,-5,-5, -5,-5,-4,-3, -2,-1,0,1,   2,3,4,4,       4,4,4,4, ... //64-95
   4,4,4,4,     4,3,2,1,      0,-1,-2,-3,  -4,-5,-6,-6, -6,-6,-6,-6, -6,-6,-6,-6, -6,-6,-5,-4,  -3,-2,-1,0, ... //96-127
   1,2,3,4,     5,5,5,5,      5,5,5,5,     5,5,5,5,      5,4,3,2,     1,0,-1,-2,   -3,-4,-5,-6, -7,-7,-7,-7,... //128-159
   -7,-7,-7,-7, -7,-7,-7,-7, -7,-7,-6,-5, -4,-3,-2,-1,  0,1,2,3,     4,5,6,6,      6,6,6,6,      6,6,6,6,... //160-191
   6,6,6,6,     6,5,4,3,      2,1,0,-1,    -2,-3,-4,-5, -6,-7,-8,-8, -8,-8,-8,-8, -8,-8,-8,-8,  -8,-8,-8,-8,...//192-223
   -8,-8,-7,-6, -5,-4,-3,-2, -1,0,1,2,     3,4,5,6,     7,7,7,7,     7,7,7,7,      7,7,7,7,      7,7,7,7];    %224-255
                           
pe2 = [
   0,-1,0,-1,   -2,-2,-2,-1,  0,1,1,1,      1,0,-1,-2,  -3,-3,-3,-3,  -3,-2,-1,0,  1,2,2,2,     2,2,2,1, ...  //0-31
   0,-1,-2,-3,  -4,-4,-4,-4, -4,-4,-4,-3,  -2,-1,0,1,   2,3,3,3,      3,3,3,3,     3,2,1,0,    -1,-2,-3,-4,... //32-63
   -5,-5,-5,-5, -5,-5,-5,-5, -5,-4,-3,-2,  -1,0,1,2,    3,4,4,4,      4,4,4,4,     4,4,4,3,     2,1,0,-1, ... //64-95
   -2,-3,-4,-5, -6,-6,-6,-6, -6,-6,-6,-6,  -6,-6,-6,-5, -4,-3,-2,-1,  0,1,2,3,     4,5,5,5,     5,5,5,5,  ... //96-127
   5,5,5,5,      5,4,3,2,     1,0,-1,-2,   -3,-4,-5,-6, -7,-7,-7,-7, -7,-7,-7,-7,  -7,-7,-7,-7, -7,-6,-5,-4,... //128-159
   -3,-2,-1,0,   1,2,3,4,     5,6,6,6,      6,6,6,6,     6,6,6,6,     6,6,6,5,      4,3,2,1,     0,-1,-2,-3, ... //160-191
   -4,-5,-6,-7, -8,-8,-8,-8, -8,-8,-8,-8,  -8,-8,-8,-8, -8,-8,-8,-7, -6,-5,-4,-3,  -2,-1,0,1,    2,3,4,5,  ...  //192-223
   6,7,7,7,      7,7,7,7,     7,7,7,7,      7,7,7,7,     7,6,5,4,     3,2,1,0,     -1,-2,-3,-4, -5,-6,-7,-8]; %224-255


ssize=8; rsize=128; psize=8;




fileID = fopen(join([foldpath,'\fid'],''),'r');
fidFile=fread(fileID, 'int32');
fclose(fileID);

% fileID2 = fopen(join(['C:\IBECPostDocDrive\2023_04_21_MatlabMRIDataProcessing\VoxelsPossitionTests\20230426_170750_CSIVoxelTests_2_CSIVoxelTests_2_1_1\5','\fid_proc.64'],''),'r');
% fidFile2=fread(fileID2, 'int32');
% fclose(fileID2);



fidFile2=complex(fidFile(1:2:end), fidFile(2:2:end));


p1=fidFile2;

nr=1;
clear out1
clear out
p = rsize*psize*ssize*(nr-1);  %note nr index 0 to images-1
for r=1:rsize*psize*ssize
    out1(r) = p1(p+1);
    p=p+1;
end


p2 = out1;
i = 0; t=0;
for d=1:(psize*ssize)
    p = pe1(d) + psize/2;  %PE step count: 0 to psize-1
    s = pe2(d) + ssize/2;  %0 to ssize-1
    for r=1:rsize-1
         t= (s*psize*rsize) + (p*rsize) + r;
         out(t+1) = p2(i+1);  %write to intermed buffer
         i = i+1; t = t+1;
    end
end
        

datt = reshape(out, 128,8,8);



figure
plot(real(out1(1,1:end)))


figure
plot(real(out(1,1:end)))







figure
plot(p1(1:500,1))


figure
plot(out(1,1:128), out(1,129:128*2))


figure
plot(out1(1,1:128*8))

figure
plot(out(1,1:128*8))


mm = fidFile(1:size(fidFile)/2)+1i*fidFile(size(fidFile)/2+1:size(fidFile))

mm2 = fidFile(1:128)+1i*fidFile(129:256)


fidFile2=complex(fidFile(1:2:end), fidFile(2:2:end));

fidFile2=complex(fidFile(1:128), fidFile(129:256));




